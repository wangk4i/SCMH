患者信息迁出外省（直报1）

1 入参数据检查
2 入参数据业务检查
   判断迁往机构下是否有基层直报
     如果没有 返回提示消息给用户
   判断患者信息是否已经同步国网
     如果没有 
		//todo 发送同步档案消息
		返回提示消息给用户
   判断患者的随访信息是否已经同步国网
     如果没有 
		//todo 发送同步随访消息
		返回提示消息给用户
		
3 业务逻辑
   构建国网编码的json数据
   调用患者跨省迁出服务接口
   如果code -1 持久化到DB 返回错误信息给用户
   如果成功
   
   
报告卡迁出外省（直报2）
1.入参校验（判断地区肯定是区县）
2.判断这个报告卡的状态 是否存在 同步有错未同步，直接提示消息给用户
3.判断这个迁出机构的类型 社区、区县 OrgType 是否为区县，如果选择区县没有选择机构的时候默认赋值9个0；
4.判断选择社区时候的机构下是否有基层直报，无提示消息给用户
5.构建国网迁出接口json数据，调用封装接口发送数据，成功之后执行第6步
6.回写省网（写入流转信息---直接条用存储过程） 如省网回写发生异常，调用报告卡回收接口，回滚操作

报告卡迁出外省（县本级1）
1.入参校验
2.根据流转编码获取报告卡信息，判断报告的状态 是否存在 同步有错未同步，直接提示消息给用户
3.判断这个迁出机构的类型 社区、区县 OrgType 是否为区县，如果选择区县没有选择机构的时候默认赋值9个0；
4.构建国网迁出接口json数据，调用封装接口发送数据，成功之后执行第5步
5.回写省网（写入流转信息---直接条用存储过程） 如省网回写发生异常，调用报告卡回收接口，回滚操作

报告卡回收（直报2，县本1）  （直报1，县本1   直报2）
1.入参校验
2.判断报告卡流转记录的国网状态 （未同步国家 直接提示消息给用户），本地迁出记录的数据状态；
3.构建国网json数据，条用回收接口，失败返回国网消息给用户，成功的时候更新流转记录

报告卡接收 （直报1，县本1）
1.入参校验
2.。。。。。。。。。
3.（新增档案，档案合并），判断当前这份报告在我省流转记录中的最初一条是否为外省流转过来，
4.如为外省流转过来报告卡，查询我省的患者信息，构建接收建档国网接口json数据，
5.接收失败，返回国网错误消息用户，成功回写国网id到db.

1.入参校验
2.判断当前这份报告在我省流转记录中的最初一条是否为外省流转过来
3.如为外省，调用接收建档接口。成功回写国网id到db.

患者基本信息跨省迁出（直报1）
1.入参校验
2.判断患者信息国网状态，随访数据的状态
3.判断迁出地区为区县、社区的逻辑（9个0和机构下有无基层直报）
4.构建国网迁出json数据，迁出失败提示用户，
5.迁出成功回写DB(判断有无流转记录，如无生成新的流转记录，有更新现有流转记录)

患者基本信息跨省迁出撤回（直报1）
1.入参校验
2.判断流转记录的状态，（如未同步国网，直接更新DB数据状态）
3.条用国网回收接口，如错误，提示给用户，
4.回写撤回成功该流转记录

跨省迁入患者接收（直报1，县本1）
1.入参校验
2.县本1接收的分发，判断这个流转是否存在，根据流转编号查询本地的患者信息，调用接收建档接口--回写DB 数据
3.直报1接收（判断本地大难是否存在，如不存在直接提示用户），涉及响应接口，调用国网接收建档接口，回写流转记录

跨省迁入患者拒绝（直报1，县本1）
1.参数校验
2.调用接收拒绝接口，回写DB (更新流转记录)

跨省重复患者迁出申请 （直报1）
（申请前，调用国网查重接口查询重复患者信息后才能执行下面的操作）
1.参数校验
2.判断患者信息国网状态，判断是否有未完结的流转记录，
3.构建重复迁移患者数据（判断我省是否存在该患者信息，如无直接发起申请，回写DB），
4.患者基本信息存在，管理地区不等于当前并且管理机构不等于省内，判断国网的主键和本地主键是否相同
5.主键相同发起申请，传入构建数据。回写DB。不同提示用户信息。
6.患者基本信息存在，在我省管理提示用户无法发起重复迁移（和4相反）


跨省重复患者迁移申请收回
1.参数校验
2.构建国网数据，调用迁移申请收回 回写DB.

跨省重复患者迁入申请受理
1.入参校验
2.判断国网重复迁移申请记录是否存在
3.判断我省患者信息是否存在，是否有未完结的流转记录，当前的管理机构和患者基本信息机构不符
4.构建重复患者迁移申请审核数据，调用接口，回写DB状态。

跨省重复患者迁入拒绝
1.入参校验
2......
3.回写DB





患者转死亡（县本1）
1.参数校验
2.判断患者的基本信息，随访数据，发送转死亡消息到消息队列






   
      
	 